<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>综合素质雷达图生成器 - 提交页</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
      :root{
        --bg:#0b1220;
        --panel:rgba(255,255,255,0.06);
        --panel-strong:rgba(255,255,255,0.12);
        --text:#e8f0ff;
        --sub:#98b4ff;
        --primary:#3a86ff;
        --primary-2:#22d3ee;
        --glow:0 0 18px rgba(58,134,255,.45);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; color:var(--text); background:radial-gradient(1200px 600px at 70% -10%,rgba(26,54,120,.35),transparent),
        radial-gradient(800px 400px at -10% 30%,rgba(34,211,238,.25),transparent), var(--bg);
        font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, sans-serif;
        overflow-x:hidden;
      }
      /* 细腻的数据流动背景 */
      .data-flow::before{
        content:""; position:fixed; inset:0; pointer-events:none; opacity:.35;
        background:
          repeating-linear-gradient(120deg, rgba(47,93,230,.12) 0 2px, transparent 2px 10px),
          repeating-linear-gradient(300deg, rgba(34,211,238,.08) 0 2px, transparent 2px 12px);
        animation:flow 14s linear infinite;
      }
      @keyframes flow{to{transform:translateX(-120px)}}

      header{
        position:relative; padding:28px 24px; text-align:center; z-index:1;
        background:linear-gradient(135deg,#2740ff,#15b2ff);
        box-shadow:var(--glow);
        border-bottom:1px solid rgba(255,255,255,.12);
      }
      header h1{margin:0; font-size:28px; letter-spacing:.5px}
      header p{margin:6px 0 0; color:#cfe0ff}

      .wrap{display:grid; grid-template-columns: 360px 1fr; gap:20px; padding:22px; max-width:1300px; margin:0 auto}
      .card{background:var(--panel); border:1px solid var(--panel-strong); border-radius:16px; box-shadow:var(--glow)}
      .left{padding:18px}
      .section-title{display:flex; align-items:center; gap:8px; color:#dbe7ff; font-weight:700; margin:6px 0 16px}
      .section-title::before{content:""; width:8px; height:8px; border-radius:50%; background:var(--primary); box-shadow:0 0 8px var(--primary)}

      .row{background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px 12px 10px; margin-bottom:12px}
      .row-label{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; color:#dbe7ff}
      .value-badge{min-width:34px; text-align:center; font-variant-numeric:tabular-nums; color:#cfe0ff}
      .sub{font-size:12px; color:#9fb7ff}
      input[type=range]{width:100%}
      .weight-line{display:flex; align-items:center; gap:8px}
      .weight-line span{white-space:nowrap}

      .actions{display:flex; gap:10px; margin-top:14px}
      button{
        appearance:none; border:none; cursor:pointer; padding:10px 14px; border-radius:10px; color:#0b1220; font-weight:700;
        background:linear-gradient(135deg,#4ea1ff,#22d3ee); box-shadow:0 8px 24px rgba(46,155,255,.35);
      }
      button.secondary{color:#d7e4ff; background:transparent; border:1px solid rgba(148,190,255,.35)}
      button:active{transform:translateY(1px)}

      .chart-card{padding:10px; display:flex; flex-direction:column}
      #chart{height:560px; width:100%}
      .tips{margin:4px 10px 10px; color:#9fb7ff; font-size:12px}

      .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:8px}
      .field{display:flex; flex-direction:column; gap:6px}
      .field label{color:#cfe0ff}
      .field input[type=text]{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); border-radius:8px; padding:8px 10px; color:var(--text)}

      @media (max-width: 980px){
        .wrap{grid-template-columns:1fr}
      }
    </style>
  </head>
  <body class="data-flow">
    <header>
      <h1>综合素质雷达图生成器</h1>
      <p>调整 6 个维度与独立权重，实时预览并提交到展示页</p>
    </header>

    <main class="wrap">
      <section class="card left">
        <div class="section-title">第一组数据</div>

        <div class="grid-2" style="margin-bottom:8px">
          <div class="field">
            <label>图表标题</label>
            <input id="titleInput" type="text" placeholder="例如：高一(3)班 综合素质" value="综合素质雷达图" />
          </div>
          <div class="field">
            <label>备注/标签</label>
            <input id="tagInput" type="text" placeholder="可选，例如：期中测评" />
          </div>
        </div>

        <div id="controls"></div>

        <div class="actions">
          <button id="submitBtn">提交到展示页</button>
          <button id="copyBtn" class="secondary" title="复制展示页链接">复制展示链接</button>
          <button id="resetBtn" class="secondary">重置</button>
        </div>
        <div class="tips">提示：提交后会将数据保存在浏览器本地（localStorage），并跳转到展示页读取渲染。</div>
      </section>

      <section class="card chart-card">
        <div id="chart"></div>
        <div class="tips">图例说明：原始分数 vs 按维度权重加权（分数×权重/100）。</div>
      </section>
    </main>

    <script>
      const dims = [
        "人文底蕴","科学精神","学会学习","健康生活","责任担当","实践创新"
      ];
      const state = {
        scores: Array(6).fill(50),
        weights: Array(6).fill(50)
      };

      const $ = (s)=>document.querySelector(s);
      const controls = $('#controls');

      function rowTemplate(i){
        return `
          <div class="row" data-idx="${i}">
            <div class="row-label">
              <div>${dims[i]}</div>
              <div class="value-badge"><span id="scoreVal${i}">${state.scores[i]}</span></div>
            </div>
            <input id="score${i}" type="range" min="0" max="100" step="1" value="${state.scores[i]}" />
            <div class="weight-line sub" style="margin-top:6px">
              <span>权重</span>
              <input id="weight${i}" type="range" min="0" max="100" step="1" value="${state.weights[i]}" />
              <span class="value-badge" id="weightVal${i}">${state.weights[i]}</span>
            </div>
          </div>`;
      }
      controls.innerHTML = dims.map((_,i)=>rowTemplate(i)).join('');

      // ECharts 初始化
      const chart = echarts.init(document.getElementById('chart'));
      function computeWeighted(){
        return state.scores.map((v,i)=> Math.round(v * state.weights[i] / 100));
      }
      function render(){
        const indicators = dims.map(()=>({max:100}));
        const weighted = computeWeighted();
        chart.setOption({
          backgroundColor:'transparent',
          legend:{top:10, textStyle:{color:'#d7e4ff'}},
          radar:{
            shape:'polygon',
            radius:'70%',
            indicator: dims.map(d=>({name:d,max:100})),
            axisName:{color:'#cfe0ff'},
            splitArea:{areaStyle:{color:[
              'rgba(62,119,255,0.05)','rgba(62,119,255,0.07)','rgba(62,119,255,0.08)','rgba(62,119,255,0.09)','rgba(62,119,255,0.10)'] }},
            axisLine:{lineStyle:{color:'rgba(160,200,255,.25)'}},
            splitLine:{lineStyle:{color:'rgba(160,200,255,.25)'}}
          },
          series:[
            {name:'原始分数', type:'radar', data:[state.scores], areaStyle:{color:'rgba(34,211,238,.18)'},
             lineStyle:{color:'#22d3ee'}, itemStyle:{color:'#22d3ee'}},
            {name:'加权分数', type:'radar', data:[weighted], areaStyle:{color:'rgba(58,134,255,.18)'},
             lineStyle:{color:'#3a86ff'}, itemStyle:{color:'#3a86ff'}}
          ]
        });
      }
      render();

      function attach(i){
        const s = document.getElementById('score'+i);
        const w = document.getElementById('weight'+i);
        s.addEventListener('input',e=>{state.scores[i]=+e.target.value; document.getElementById('scoreVal'+i).textContent=e.target.value; render();});
        w.addEventListener('input',e=>{state.weights[i]=+e.target.value; document.getElementById('weightVal'+i).textContent=e.target.value; render();});
      }
      dims.forEach((_,i)=>attach(i));

      function genId(){
        if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
        return 'radar_'+Date.now()+"_"+Math.random().toString(16).slice(2);
      }
      function buildPayload(){
        const title = document.getElementById('titleInput').value.trim()||'综合素质雷达图';
        const tag = document.getElementById('tagInput').value.trim();
        return {
          id: genId(),
          title, tag,
          dims: [...dims],
          scores: [...state.scores],
          weights: [...state.weights],
          weighted: computeWeighted(),
          submittedAt: new Date().toISOString(),
          version: 1
        };
      }

      async function copy(text){
        try{ await navigator.clipboard.writeText(text); return true; }catch(e){
          const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); return true;
        }
      }

      function goDisplay(payload){
        const key = 'radarPayload:'+payload.id;
        localStorage.setItem(key, JSON.stringify(payload));
        const url = `display.html?id=${encodeURIComponent(payload.id)}`;
        location.href = url;
      }

      document.getElementById('submitBtn').addEventListener('click',()=>{
        const payload = buildPayload();
        goDisplay(payload);
      });

      document.getElementById('copyBtn').addEventListener('click', async ()=>{
        const payload = buildPayload();
        const key = 'radarPayload:'+payload.id;
        localStorage.setItem(key, JSON.stringify(payload));
        const url = location.origin + location.pathname.replace(/[^/]*$/, '') + `display.html?id=${encodeURIComponent(payload.id)}`;
        await copy(url);
        alert('展示链接已复制：\n'+url);
      });

      document.getElementById('resetBtn').addEventListener('click',()=>{
        state.scores = Array(6).fill(50);
        state.weights = Array(6).fill(50);
        dims.forEach((_,i)=>{
          document.getElementById('score'+i).value=50; document.getElementById('scoreVal'+i).textContent='50';
          document.getElementById('weight'+i).value=50; document.getElementById('weightVal'+i).textContent='50';
        });
        document.getElementById('titleInput').value='综合素质雷达图';
        document.getElementById('tagInput').value='';
        render();
      });

      window.addEventListener('resize', ()=> chart.resize());
    </script>
  </body>
</html>

