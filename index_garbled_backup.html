<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ç»¼åˆç´ è´¨é›·è¾¾å›¾ç”Ÿæˆå™¨ - æäº¤é¡?/title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
      :root{
        --bg:#0b1220;
        --panel:rgba(255,255,255,0.06);
        --panel-strong:rgba(255,255,255,0.12);
        --text:#e8f0ff;
        --sub:#98b4ff;
        --primary:#3a86ff;
        --primary-2:#22d3ee;
        --glow:0 0 18px rgba(58,134,255,.45);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; color:var(--text); background:radial-gradient(1200px 600px at 70% -10%,rgba(26,54,120,.35),transparent),
        radial-gradient(800px 400px at -10% 30%,rgba(34,211,238,.25),transparent), var(--bg);
        font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, sans-serif;
        overflow-x:hidden;
      }
      /* ç»†è…»çš„æ•°æ®æµåŠ¨èƒŒæ™?*/
      .data-flow::before{
        content:""; position:fixed; inset:0; pointer-events:none; opacity:.35;
        background:
          repeating-linear-gradient(120deg, rgba(47,93,230,.12) 0 2px, transparent 2px 10px),
          repeating-linear-gradient(300deg, rgba(34,211,238,.08) 0 2px, transparent 2px 12px);
        animation:flow 14s linear infinite;
      }
      @keyframes flow{to{transform:translateX(-120px)}}

      header{
        position:relative; padding:28px 24px; text-align:center; z-index:1;
        background:linear-gradient(135deg,#2740ff,#15b2ff);
        box-shadow:var(--glow);
        border-bottom:1px solid rgba(255,255,255,.12);
      }
      header h1{margin:0; font-size:28px; letter-spacing:.5px}
      header p{margin:6px 0 0; color:#cfe0ff}

      .wrap{display:grid; grid-template-columns: 720px 1fr; gap:20px; padding:22px; max-width:1300px; margin:0 auto}
      .card{background:var(--panel); border:1px solid var(--panel-strong); border-radius:16px; box-shadow:var(--glow)}
      .left{padding:18px}
      .section-title{display:flex; align-items:center; gap:8px; color:#dbe7ff; font-weight:700; margin:6px 0 16px}
      .section-title::before{content:""; width:8px; height:8px; border-radius:50%; background:var(--primary); box-shadow:0 0 8px var(--primary)}

      .row{background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px 12px 10px; margin-bottom:12px}
      .row-label{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; color:#dbe7ff}
      .value-badge{min-width:34px; text-align:center; font-variant-numeric:tabular-nums; color:#cfe0ff}
      .sub{font-size:12px; color:#9fb7ff}
      input[type=range]{width:100%}
      .num-wrap{display:flex; align-items:center; gap:8px}
      .num{width:110px; max-width:40vw; text-align:center; color:var(--text);
        background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1);
        padding:8px 10px; border-radius:8px; outline:none}
      .num:focus{border-color:#64b5ff; box-shadow:0 0 0 3px rgba(100,181,255,.15)}
      .weight-line{display:flex; align-items:center; gap:8px}
      .weight-line span{white-space:nowrap}

      /* è¡¨æ ¼å¸ƒå±€ */
      .matrix{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; border:1px solid rgba(255,255,255,.08)}
      .matrix th, .matrix td{border-right:1px solid rgba(255,255,255,.08); border-bottom:1px solid rgba(255,255,255,.08); padding:10px; text-align:center}
      .matrix thead th{background:linear-gradient(180deg, rgba(78,161,255,.22), rgba(34,211,238,.06)); color:#e7f1ff}
      .matrix tbody th{background:rgba(255,255,255,.04); color:#dbe7ff; font-weight:600; width:96px; text-align:center}
      .matrix td{height:64px}
      .matrix input[type=number]{width:72px}

      .actions{display:flex; gap:10px; margin-top:14px; align-items:center}
      button{
        appearance:none; border:none; cursor:pointer; padding:10px 14px; border-radius:10px; color:#0b1220; font-weight:700;
        background:linear-gradient(135deg,#4ea1ff,#22d3ee); box-shadow:0 8px 24px rgba(46,155,255,.35);
      }
      button.secondary{color:#d7e4ff; background:transparent; border:1px solid rgba(148,190,255,.35)}
      button:active{transform:translateY(1px)}
      button:disabled{filter:grayscale(.6); opacity:.7; cursor:not-allowed}
      .sum-tip{margin-left:auto; font-variant-numeric:tabular-nums}
      .sum-tip .ok{color:#7CFFB2}
      .sum-tip .bad{color:#ffb3b3}

      .chart-card{padding:10px; display:flex; flex-direction:column}
      #chart{height:560px; width:100%}
      .tips{margin:4px 10px 10px; color:#9fb7ff; font-size:12px}

      .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:8px}
      .field{display:flex; flex-direction:column; gap:6px}
      .field label{color:#cfe0ff}
      .field input[type=text]{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); border-radius:8px; padding:8px 10px; color:var(--text)}

      @media (max-width: 980px){
        .wrap{grid-template-columns:1fr}
      }
    </style>
  </head>
  <body class="data-flow">
    <header>
      <h1>ç»¼åˆç´ è´¨é›·è¾¾å›¾ç”Ÿæˆå™¨</h1>
      <p>è°ƒæ•´ 6 ä¸ªç»´åº¦ä¸ç‹¬ç«‹æƒé‡ï¼Œå®æ—¶é¢„è§ˆå¹¶æäº¤åˆ°å±•ç¤ºé¡µ</p>
    </header>

    <main class="wrap">
      <section class="card left">
        <div class="section-title">ç¬¬ä¸€ç»„æ•°æ?/div>

        <div class="grid-2" style="margin-bottom:8px">
          <div class="field">
            <label>å›¾è¡¨æ ‡é¢˜</label>
            <input id="titleInput" type="text" placeholder="ä¾‹å¦‚ï¼šé«˜ä¸€(3)ç?ç»¼åˆç´ è´¨" value="ç»¼åˆç´ è´¨é›·è¾¾å›? />
          </div>
          <div class="field">
            <label>å¤‡æ³¨/æ ‡ç­¾</label>
            <input id="tagInput" type="text" placeholder="å¯é€‰ï¼Œä¾‹å¦‚ï¼šæœŸä¸­æµ‹è¯? />
          </div>
        </div>

        <div id="controls"></div>

        <div class="actions">
          <button id="submitBtn">æäº¤åˆ°å±•ç¤ºé¡µ</button>
          <button id="copyBtn" class="secondary" title="å¤åˆ¶å±•ç¤ºé¡µé“¾æ?>å¤åˆ¶å±•ç¤ºé“¾æ¥</button>
          <button id="resetBtn" class="secondary">é‡ç½®</button>
          <div class="sum-tip sub">æƒé‡åˆè®¡ï¼?span id="weightSum" class="bad">300%</span>ï¼ˆéœ€ç­‰äº 100%ï¼?/div>
        </div>
        <div class="tips">æç¤ºï¼šæäº¤åä¼šå°†æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼ˆlocalStorageï¼‰ï¼Œå¹¶è·³è½¬åˆ°å±•ç¤ºé¡µè¯»å–æ¸²æŸ“ã€?/div>
      </section>

      <section class="card chart-card">
        <div id="chart"></div>
        <div class="tips">å›¾ä¾‹è¯´æ˜ï¼šåŸå§‹åˆ†æ•?vs æŒ‰ç»´åº¦æƒé‡åŠ æƒï¼ˆåˆ†æ•°Ã—æƒé‡/100ï¼‰ã€?/div>
      </section>
    </main>

    <script>
      const dims = [
        "äººæ–‡åº•è•´","ç§‘å­¦ç²¾ç¥","å­¦ä¼šå­¦ä¹ ","å¥åº·ç”Ÿæ´»","è´£ä»»æ‹…å½“","å®è·µåˆ›æ–°"
      ];
      const state = {
        scores: Array(6).fill(50),
        weights: Array(6).fill(50)
      };

      const $ = (s)=>document.querySelector(s);
      const controls = $('#controls');

      function buildTable(){
        const header = `
          <thead>
            <tr>
              <th style="width:90px">å§“å</th>
              ${dims.map(d=>`<th>${d}<br><span class="sub">100åˆ?/span></th>`).join('')}
            </tr>
          </thead>`;
        const weightRow = `
          <tr>
            <th>æˆé•¿æƒé‡</th>
            ${dims.map((_,i)=>`<td><input id="weight${i}" class="num" type="number" min="0" max="100" step="1" inputmode="numeric" pattern="\\\d*" value="${state.weights[i]}" />%</td>`).join('')}
          </tr>`;
        const scoreRow = `
          <tr>
            <th>è‡ªæˆ‘è¯„ä»·</th>
            ${dims.map((_,i)=>`<td><input id="score${i}" class="num" type="number" min="0" max="100" step="1" inputmode="numeric" pattern="\\\d*" value="${state.scores[i]}" /></td>`).join('')}
          </tr>`;
        return `<table class="matrix">${header}<tbody>${weightRow}${scoreRow}</tbody></table>`;
      }
      controls.innerHTML = buildTable();

      // ECharts åˆå§‹åŒ?      const chart = echarts.init(document.getElementById('chart'));
      function computeWeighted(){
        return state.scores.map((v,i)=> Math.round(v * state.weights[i] / 100));
      }
      function sumWeights(){ return state.weights.reduce((a,b)=>a+b,0); }
      function refreshSumTip(){
        const s = sumWeights();
        const el = document.getElementById('weightSum');
        el.textContent = s+"%";
        el.className = (s===100? 'ok':'bad');
        const canSubmit = s===100;
        const tip = canSubmit? 'æƒé‡å·²è¾¾100%ï¼Œå¯æäº¤':'æˆé•¿æƒé‡åˆè®¡éœ€ç­‰äº100%';
        const submit = document.getElementById('submitBtn');
        const copy = document.getElementById('copyBtn');
        submit.disabled = !canSubmit; submit.title = tip;
        copy.disabled = !canSubmit; copy.title = tip + 'ï¼ˆå¤åˆ¶å‰è¯·æ»¡è¶³è¦æ±‚ï¼‰';
      }
      function render(){
        const indicators = dims.map(()=>({max:100}));
        const weighted = computeWeighted();
        chart.setOption({
          backgroundColor:'transparent',
          legend:{top:10, textStyle:{color:'#d7e4ff'}},
          radar:{
            shape:'polygon',
            radius:'70%',
            indicator: dims.map(d=>({name:d,max:100})),
            axisName:{color:'#cfe0ff'},
            splitArea:{areaStyle:{color:[
              'rgba(62,119,255,0.05)','rgba(62,119,255,0.07)','rgba(62,119,255,0.08)','rgba(62,119,255,0.09)','rgba(62,119,255,0.10)'] }},
            axisLine:{lineStyle:{color:'rgba(160,200,255,.25)'}},
            splitLine:{lineStyle:{color:'rgba(160,200,255,.25)'}}
          },
          series:[
            {name:'åŸå§‹åˆ†æ•°', type:'radar', data:[state.scores], areaStyle:{color:'rgba(34,211,238,.18)'},
             lineStyle:{color:'#22d3ee'}, itemStyle:{color:'#22d3ee'}},
            {name:'åŠ æƒåˆ†æ•°', type:'radar', data:[weighted], areaStyle:{color:'rgba(58,134,255,.18)'},
             lineStyle:{color:'#3a86ff'}, itemStyle:{color:'#3a86ff'}}
          ]
        });
        refreshSumTip();
      }
      render();

      function clampInt(v,min,max){
        v = parseInt(String(v||'').replace(/[^\d-]/g,''),10);
        if(isNaN(v)) v=0; if(v<min) v=min; if(v>max) v=max; return v;
      }
      function preventWheelNumber(el){
        el.addEventListener('wheel', e=>{ e.preventDefault(); }, {passive:false});
        el.addEventListener('keydown', e=>{ if(e.key==='e'||e.key==='E' || e.key==='+' || e.key==='-') e.preventDefault(); });
      }
      function attach(i){
        const s = document.getElementById('score'+i);
        const w = document.getElementById('weight'+i);
        preventWheelNumber(s); preventWheelNumber(w);
        const onScore = (e)=>{ const v=clampInt(e.target.value,0,100); if(e.target.value!=v) e.target.value=v; state.scores[i]=v; render(); };
        const onWeight = (e)=>{ const v=clampInt(e.target.value,0,100); if(e.target.value!=v) e.target.value=v; state.weights[i]=v; render(); };
        s.addEventListener('input', onScore); s.addEventListener('change', onScore);
        w.addEventListener('input', onWeight); w.addEventListener('change', onWeight);
      }
      dims.forEach((_,i)=>attach(i));

      function genId(){
        if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
        return 'radar_'+Date.now()+"_"+Math.random().toString(16).slice(2);
      }
      function buildPayload(){
        const title = document.getElementById('titleInput').value.trim()||'ç»¼åˆç´ è´¨é›·è¾¾å›?;
        const tag = document.getElementById('tagInput').value.trim();
        return {
          id: genId(),
          title, tag,
          dims: [...dims],
          scores: [...state.scores],
          weights: [...state.weights],
          weighted: computeWeighted(),
          submittedAt: new Date().toISOString(),
          version: 1
        };
      }

      async function copy(text){
        try{ await navigator.clipboard.writeText(text); return true; }catch(e){
          const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); return true;
        }
      }

      function goDisplay(payload){
        const key = 'radarPayload:'+payload.id;
        localStorage.setItem(key, JSON.stringify(payload));
        const url = `display.html?id=${encodeURIComponent(payload.id)}`;
        location.href = url;
      }

      document.getElementById('submitBtn').addEventListener('click',()=>{
        if(sumWeights()!==100){ alert('è¯·å°†å…­ä¸ªæƒé‡æ•°å€¼è°ƒæ•´ä¸ºåˆè®¡ 100%'); return; }
        const payload = buildPayload();
        goDisplay(payload);
      });

      document.getElementById('copyBtn').addEventListener('click', async ()=>{
        if(sumWeights()!==100){ alert('è¯·å…ˆå°†æƒé‡åˆè®¡è°ƒæ•´ä¸º 100% å†å¤åˆ¶é“¾æ?); return; }
        const payload = buildPayload();
        const key = 'radarPayload:'+payload.id;
        localStorage.setItem(key, JSON.stringify(payload));
        const url = location.origin + location.pathname.replace(/[^/]*$/, '') + `display.html?id=${encodeURIComponent(payload.id)}`;
        await copy(url);
        alert('å±•ç¤ºé“¾æ¥å·²å¤åˆ¶ï¼š\n'+url);
      });

      document.getElementById('resetBtn').addEventListener('click',()=>{
        state.scores = Array(6).fill(50);
        state.weights = Array(6).fill(50);
        dims.forEach((_,i)=>{
          document.getElementById('score'+i).value=50;
          document.getElementById('weight'+i).value=50;
        });
        document.getElementById('titleInput').value='ç»¼åˆç´ è´¨é›·è¾¾å›?;
        document.getElementById('tagInput').value='';
        render();
      });

      // ä¿®æ­£æ ‡é¢˜è¾“å…¥æ¡†é»˜è®¤å€¼ï¼ˆå¤„ç†å†å²ç¼–ç é—®é¢˜ï¼?      document.getElementById('resetBtn').addEventListener('click',()=>{
        document.getElementById('titleInput').value='ç»¼åˆç´ è´¨é›·è¾¾å›?;
      });

      window.addEventListener('resize', ()=> chart.resize());
      refreshSumTip();
    </script>
  </body>
</html>

